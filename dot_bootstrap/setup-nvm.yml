---
- name: NVM setup 
  hosts: ubuntuNode1
  gather_facts: false
  become: true
  tasks:
    - name: Get latest version tag of nvm
      uri:
        url: 'https://api.github.com/repos/nvm-sh/nvm/releases/latest'
        return_content: yes
      register: nvm_release
      become: true

    - set_fact:
        nvm_version: "{{ nvm_release.json.tag_name | regex_replace('^v', '') }}"

    - name: Install nvm
      ansible.builtin.shell: >
        curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v{{nvm_version}}/install.sh | bash
      args:
        creates: "/home/ubuntu/.nvm/nvm.sh"

    - name: Install latest node using nvm
      ansible.builtin.shell:
        cmd: "source /home/ubuntu/.nvm/nvm.sh && nvm install --lts"
      become: true
      args:
        executable: /bin/bash
      ignore_errors: true

